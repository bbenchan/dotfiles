#!/bin/bash

# A script to get colours from xrdb & deploy it to polybar, alacritty & rofi.

getcolors () {
	FOREGROUND="$(xrdb -query | grep 'foreground:'| awk '{print $NF}')"
	BACKGROUND="$(xrdb -query | grep 'background:'| awk '{print $NF}')"
	CURSOR="$(xrdb -query | grep 'cursorColor:'| awk '{print $NF}')"
	BLACK="$(xrdb -query | grep 'color0:'| awk '{print $NF}')"
	RED="$(xrdb -query | grep 'color1:'| awk '{print $NF}')"
	GREEN="$(xrdb -query | grep 'color2:'| awk '{print $NF}')"
	YELLOW="$(xrdb -query | grep 'color3:'| awk '{print $NF}')"
	BLUE="$(xrdb -query | grep 'color4:'| awk '{print $NF}')"
	MAGENTA="$(xrdb -query | grep 'color5:'| awk '{print $NF}')"
	CYAN="$(xrdb -query | grep 'color6:'| awk '{print $NF}')"
	WHITE="$(xrdb -query | grep 'color7:'| awk '{print $NF}')"
	ALTBLACK="$(xrdb -query | grep 'color8:'| awk '{print $NF}')"
	ALTRED="$(xrdb -query | grep 'color9:'| awk '{print $NF}')"
	ALTGREEN="$(xrdb -query | grep 'color10:'| awk '{print $NF}')"
	ALTYELLOW="$(xrdb -query | grep 'color11:'| awk '{print $NF}')"
	ALTBLUE="$(xrdb -query | grep 'color12:'| awk '{print $NF}')"
	ALTMAGENTA="$(xrdb -query | grep 'color13:'| awk '{print $NF}')"
	ALTCYAN="$(xrdb -query | grep 'color14:'| awk '{print $NF}')"
	ALTWHITE="$(xrdb -query | grep 'color15:'| awk '{print $NF}')"
}

bspbar () {
	cat > $HOME/.config/polybar/colors <<- EOF
	[color]

	FOREGROUND = ${FOREGROUND}
	BACKGROUND = ${BACKGROUND}
	BLACK = ${BLACK}
	RED = ${RED}
	GREEN = ${GREEN}
	YELLOW = ${YELLOW}
	BLUE = ${BLUE}
	MAGENTA = ${MAGENTA}
	CYAN = ${CYAN}
	WHITE = ${WHITE}
	ALTBLACK = ${ALTBLACK}
	ALTRED = ${ALTRED}
	ALTGREEN = ${ALTGREEN}
	ALTYELLOW = ${ALTYELLOW}
	ALTBLUE = ${ALTBLUE}
	ALTMAGENTA = ${ALTMAGENTA}
	ALTCYAN = ${ALTCYAN}
	ALTWHITE = ${ALTWHITE}
	EOF
}

bspterm () {
	mkdir -p ${TMPDIR-/tmp}/alacritty
	cat > ${TMPDIR-/tmp}/alacritty/color.yml <<- EOF
	colors:
	  primary:
	    background: '${BACKGROUND}'
	    foreground: '${FOREGROUND}'
	  normal:
	    black:   '${BLACK}'
	    red:     '${RED}'
	    green:   '${GREEN}'
	    yellow:  '${YELLOW}'
	    blue:    '${BLUE}'
	    magenta: '${MAGENTA}'
	    cyan:    '${CYAN}'
	    white:   '${WHITE}'
	  bright:
	    black:   '${ALTBLACK}'
	    red:     '${ALTRED}'
	    green:   '${ALTGREEN}'
	    yellow:  '${ALTYELLOW}'
	    blue:    '${ALTBLUE}'
	    magenta: '${ALTMAGENTA}'
	    cyan:    '${ALTCYAN}'
	    white:   '${ALTWHITE}'
	EOF

  alacritty-colorscheme -c $HOME/.config/alacritty/alacritty.yml -C "${TMPDIR-/tmp}/alacritty" -a color.yml
}

bsprofi () {
	cat > $HOME/.config/rofi/themes/colors.rasi <<- EOF
	* {
		background:			${BACKGROUND};
		foreground:			${FOREGROUND};
		selected:			${BLUE};
		urgent:				${RED};
		on:					${GREEN};
		off:				${RED};
	}
	EOF
}

bspbashtop () {
  cat > $HOME/.config/bashtop/themes/default.theme <<-EOF
theme[main_fg]="${FOREGROUND}"
theme[title]="${ALTCYAN}"
theme[hi_fg]=""
theme[selected_bg]="${ALTBLACK}"
theme[selected_fg]="${ALTWHITE}"
theme[inactive_fg]="${ALTBLACK}"
theme[proc_misc]=""
theme[cpu_box]="${ALTBLACK}"
theme[mem_box]="${ALTBLACK}"
theme[net_box]="${ALTBLACK}"
theme[proc_box]="${ALTBLACK}"
theme[div_line]="${ALTBLACK}"
theme[temp_start]="${ALTBLUE}"
theme[temp_mid]="${CYAN}"
theme[temp_end]="${ALTWHITE}"
theme[cpu_start]="${ALTBLUE}"
theme[cpu_mid]="${CYAN}"
theme[cpu_end]="${ALTWHITE}"
theme[free_start]="${ALTBLUE}"
theme[free_mid]="${CYAN}"
theme[free_end]="${ALTWHITE}"
theme[cached_start]="${ALTBLUE}"
theme[cached_mid]="${CYAN}"
theme[cached_end]="${ALTWHITE}"
EOF
}

main () {
	getcolors
	bspbar
	bspterm
	bsprofi
	bspbashtop
}

main
